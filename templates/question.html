<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">

    <title>대답해</title>

    <script src="{{ url_for('static', filename='js/jquery-3.5.1.min.js')}}"></script>

    <script type="text/javascript">
        function setValue(val){
            document.getElementById("data").setAttribute("value", val)
        }

        $(document).ready(function() {
            var session = $('#session_key').val()
            var data = 0
            var postdata = {'session': session, 'answer': data};

            $.ajax({
                type: 'POST',
                url: '{{ url_for("ajax") }}',
                data: JSON.stringify(postdata),
                dataType: 'JSON',
                contentType: "application/json",
                success: function (data) {
                    console.log(data.result)
                    var next_question = "<h1>" + data.result + "</h1>"
                    $(".question").children().remove()
                    $(".question").append(next_question)

                    var next_answer = data.answer;
                    $(".answer").empty()
                    for(var i = 0; i < next_answer.length;i++){
                        var next_button = "<button type = 'button' id = '" + i + "' value = 'udo_v" + (i + 1) +"'>" + next_answer[i] + "</button>"
                        console.log(next_button)
                        $(".answer").append(next_button)
                    }
                },
                error: function (request, status, error) {
                    alert('ajax 통신 실패')
                    alert(error);
                }
            })
        });

        $(document).on('click', 'button', function () {

            var session = $('#session_key').val()
            var data = $(this).val()
            var postdata = {'session': session, 'answer': data};
            console.log(data)
            $.ajax({
                type: 'POST',
                url: '{{ url_for("ajax") }}',
                data: JSON.stringify(postdata),
                dataType: 'JSON',
                contentType: "application/json",
                success: function (data) {

                    var next_question = "<h1>" + data.result + "</h1>"
                    $(".question").children().remove()
                    $(".question").append(next_question)

                    var next_answer = data.answer;
                    $(".answer").empty()
                    for(var i = 0; i < next_answer.length;i++){
                        var next_button = "<button type = 'button' id = '" + i  + "' value = 'udo_v" + (i + 1) +"'>" + next_answer[i] + "</button>"
                        $(".answer").append(next_button)
                    }
                },
                error: function (request, status, error) {
                    alert('ajax 통신 실패')
                    alert(error);
                }
            })
        });


    </script>

</head>
<body>

<div class="qna" name="qna">
    <form>
        <div class = "question" id = "question">

        </div>
        <div class="answer">

        </div>
        <input type = "hidden" id = "data" name = "data">
        <input type = "hidden" id = "session_key" name = "session_key" value = "{{ key }}">
    </form>
</div>

</body>
</html>